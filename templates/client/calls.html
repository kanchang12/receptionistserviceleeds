{% extends "dashboard_base.html" %}
{% block title %}Calls — VoiceBot{% endblock %}
{% block content %}
<div class="page-header">
    <h1>Call History</h1>
    <p>{{ total_count }} total calls</p>
</div>

<div class="card">
    <div class="card-body no-pad">
        {% if calls %}
        <table class="data-table">
            <thead>
                <tr><th>Date</th><th>Caller</th><th>Duration</th><th>Category</th><th>Sentiment</th><th>Summary</th><th>Status</th></tr>
            </thead>
            <tbody>
            {% for c in calls %}
            <tr onclick="location.href='{{ url_for('client_call_detail', call_id=c.id) }}'" style="cursor:pointer;">
                <td style="white-space:nowrap;font-size:0.85rem;">{{ c.created_at.strftime('%d %b %H:%M') if c.created_at else '-' }}</td>
                <td style="font-family:var(--font-mono);font-size:0.85rem;">{{ c.caller_number or 'Unknown' }}</td>
                <td>{{ ((c.duration_seconds or 0) / 60)|round(1) }}m</td>
                <td><span class="badge badge-neutral">{{ c.category or '-' }}</span></td>
                <td><span class="badge badge-{{ c.sentiment or 'neutral' }}-s">{{ c.sentiment or '-' }}</span></td>
                <td style="max-width:300px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;color:var(--text-secondary);font-size:0.85rem;">{{ c.summary or '-' }}</td>
                <td><span class="badge badge-{{ c.status }}">{{ c.status }}</span></td>
            </tr>
            {% endfor %}
            </tbody>
        </table>

        {% if total_pages > 1 %}
        <div class="pagination">
            {% if page > 1 %}<a href="?page={{ page - 1 }}">← Prev</a>{% endif %}
            {% for p in range(1, total_pages + 1) %}
                {% if p == page %}<span class="current">{{ p }}</span>
                {% elif p <= 3 or p >= total_pages - 2 or (p >= page - 1 and p <= page + 1) %}
                <a href="?page={{ p }}">{{ p }}</a>
                {% elif p == 4 or p == total_pages - 3 %}<span style="color:var(--text-muted)">…</span>{% endif %}
            {% endfor %}
            {% if page < total_pages %}<a href="?page={{ page + 1 }}">Next →</a>{% endif %}
        </div>
        {% endif %}

        {% else %}
        <div class="empty-state"><h3>No calls yet</h3><p>Your call history will appear here.</p></div>
        {% endif %}
    </div>
</div>
{% endblock %}
